# Goneat v0.3.9 — Foundation Tools & Bootstrap Automation

**Release Date**: 2025-12-01
**Status**: Release

## TL;DR

- **Security**: Guardian URL auto-approval bypass fixed - URL remotes now correctly require approval
- `prettier` added to foundation scope - CI bootstrap now installs all formatting tools automatically
- `bun` package manager auto-install in CI - fresh runners bootstrap without pre-installed package managers
- Installer priorities updated to respect system package managers (brew, scoop) over language-specific tools
- Automated release upload workflow (`make release-upload`) for complete GitHub release publishing

## Security Fix

### Guardian URL Auto-Approval Bypass (CVE Pending)

**Severity**: High
**Component**: `goneat guardian`
**Reporter**: Python Forge Engineer (@python-forge-engineer)

A security vulnerability was discovered where guardian would incorrectly auto-approve `git push` operations when the remote was specified as a URL rather than a name.

**Issue**: When using `--remote https://github.com/user/repo.git` instead of `--remote origin`, guardian would auto-approve because the URL didn't match configured patterns like `["origin", "upstream"]`.

**Impact**: Push operations to protected branches could bypass guardian approval when:

- Git's pre-push hook passed the URL instead of remote name
- Manual `goneat guardian check` was called with URL

**Fix**: New `looksLikeURL()` function in `internal/guardian/engine.go` detects URL-based remotes and applies fail-closed security. URL remotes now require approval regardless of pattern matching.

**Detection**: Identifies URLs by:

- Protocol schemes (`https://`, `http://`, `ssh://`, `git://`)
- SSH-style URLs (`git@host:path`)
- Common hosting domains (github.com, gitlab.com, bitbucket.org, azure.com)

**Recommendation**: All users should upgrade to v0.3.9 immediately.

## Highlights

### Automatic prettier Installation in CI

The groningen repository and other downstream projects were failing in CI because prettier was required for markdown formatting but not automatically installed. This release adds prettier to the foundation scope, ensuring `make bootstrap` installs all required formatting tools.

**Before**:

```yaml
# groningen .github/workflows/ci.yml - manual workaround
- name: Install formatting tools manually
  run: |
    npm install -g prettier
    go install github.com/google/yamlfmt/cmd/yamlfmt@latest
```

**After**:

```yaml
# Just use goneat bootstrap - prettier included automatically
- name: Bootstrap tools (dogfooding)
  run: |
    make bootstrap
```

### bun Package Manager Support

The bun installer was defined in v0.3.7 but not implemented. This release completes the implementation:

```bash
# Now works automatically
goneat doctor tools --scope foundation --install --yes

# Uses bun for Node.js tools when available
# Falls back to npm if bun not installed
```

**Installation**: `bun add -g prettier` → `~/.bun/bin/prettier`

### Well-Behaved Installer Priorities

Installer priorities now respect system package managers first:

**prettier**:

- darwin/linux: `brew` → `bun`
- windows: `scoop` → `winget` → `bun`

**yamlfmt**:

- darwin/linux: `brew` → `go-install`
- windows: `scoop` → `go-install`

Users can now pin versions via their system package manager (`brew pin prettier`, `scoop hold yamlfmt`).

### Automated Release Uploads

New `make release-upload` target handles complete GitHub release publishing:

```bash
# One command for complete release
make release-upload VERSION=v0.3.9

# Uploads:
# - Binaries (*.tar.gz, *.zip)
# - SHA256SUMS
# - All signatures (*.asc)
# - Public key
# - Updates release notes
```

Prevents the v0.3.8 issue where only signatures were uploaded, missing the actual binaries.

## Foundation Tools Scope

Foundation scope now includes 8 essential tools:

1. **ripgrep** - Fast text search (goneat license auditing)
2. **jq** - JSON processor (CI/CD scripts)
3. **yq** - YAML processor
4. **go** - Go toolchain (required for Go projects)
5. **go-licenses** - License compliance
6. **golangci-lint** - Fast linters runner
7. **yamlfmt** - YAML formatter and linter
8. **prettier** - Code formatter for JS/TS/JSON/Markdown/YAML _(NEW)_

## Installation

```bash
# Install goneat
brew install fulmenhq/tap/goneat

# Bootstrap all foundation tools
goneat doctor tools --scope foundation --install --yes
```

For projects using goneat in CI, add bootstrap step:

```yaml
- name: Bootstrap tools
  run: |
    make bootstrap  # Calls: goneat doctor tools --scope foundation --install --yes
```

## Breaking Changes

None - this is a backward-compatible enhancement release.

## Known Issues

None

## Upgrade Guide

### From v0.3.8

No action required - this is a drop-in upgrade. If you're using goneat in CI, the next run will automatically install prettier.

### Adding goneat to a New Repository

1. **Install package managers first** (CI/local):

   ```bash
   # macOS/Linux
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

   # Or use the package manager docs
   goneat docs show package-managers
   ```

2. **Install goneat**:

   ```bash
   brew install fulmenhq/tap/goneat
   ```

3. **Initialize tools configuration**:

   ```bash
   goneat doctor tools init
   ```

4. **Install foundation tools**:

   ```bash
   goneat doctor tools --scope foundation --install --yes
   ```

5. **Add to CI** (`.github/workflows/ci.yml`):
   ```yaml
   - name: Bootstrap tools
     run: make bootstrap
   ```

See full documentation: `goneat docs show bootstrap` _(coming soon)_

## What's Next

- v0.3.10: Enhanced bootstrap documentation and troubleshooting guides
- v0.4.0: Intelligent tool caching and version pinning

## Contributors

Generated by Forge Neat ([Claude Code](https://claude.ai/claude-code)) under supervision of @3leapsdave

Co-Authored-By: Forge Neat <noreply@3leaps.net>
Committer-of-Record: Dave Thompson <dave.thompson@3leaps.net> [@3leapsdave](https://github.com/3leapsdave)
