# Goneat v0.4.5 â€” Rust License Scanning Improvements

**Release Date**: 2026-01-13
**Status**: Stable

## TL;DR

- **Rich cargo-deny output**: Error messages now include specific license names, crate versions, and deny.toml file:line references
- **License enumeration for Rust**: `goneat dependencies --licenses` now lists all Rust dependencies with their licenses (like Go)
- **Unified implementation**: Single source of truth for cargo-deny integration (fixes stderr/NDJSON parsing bugs)

## What Changed

### Phase 1: Rich cargo-deny Output

Previously, cargo-deny output was generic:

```
cargo-deny: license: rejected, failing due to license requirements
```

Now it includes full context:

```
cargo-deny: license: rejected, failing due to license requirements [0BSD; unmatched license allowance; at deny.toml:53:6]
```

**What's included:**

| Context Type | Example |
|--------------|---------|
| Specific license name | `0BSD`, `GPL-3.0`, `Unlicense` |
| License action | `unmatched license allowance`, `rejected by policy` |
| deny.toml reference | `at deny.toml:53:6` |
| Crate version | `windows-sys v0.52.0` (for duplicate warnings) |

This makes diagnosing license issues actionable without digging through cargo-deny's raw output.

### Phase 2: License Enumeration for Rust

`goneat dependencies --licenses` now works identically for Go and Rust projects:

**Go project:**
```bash
$ goneat dependencies --licenses --format json
{"Dependencies":[{"Name":"github.com/spf13/cobra","Version":"v1.8.1","Language":"go","License":{"Name":"Apache-2.0","Type":"Apache-2.0"}},...]}
```

**Rust project:**
```bash
$ goneat dependencies --licenses --format json
{"Dependencies":[{"Name":"serde","Version":"1.0.215","Language":"rust","License":{"Name":"MIT OR Apache-2.0","Type":"MIT OR Apache-2.0"}},...]}
```

**Features:**
- Parses `cargo deny list` output (table format)
- Handles SPDX-like license expressions (`MIT OR Apache-2.0`, `Unlicense OR MIT`)
- Same `Dependency` schema as Go analyzer
- Works in Cargo workspaces

### Bug Fixes

**cargo-deny integration issues discovered during fulmen-toolbox testing:**

1. **STDERR output**: cargo-deny outputs JSON to stderr (not stdout) when using `--format json`
   - This is intentional per cargo-deny design
   - Fixed by reading from stderr in the unified implementation

2. **Command order**: `--format json` must precede `check` subcommand
   - Wrong: `cargo deny check --format json licenses`
   - Right: `cargo deny --format json check licenses`

3. **Duplicate implementation removed**: `internal/assess/rust_cargo_deny.go` now uses the canonical `pkg/dependencies.RunCargoDeny()` instead of duplicating parsing logic

4. **Severity mapping**: "note" and "help" severities now correctly map to low (was defaulting to medium)

### Implementation Notes

**New functions in `pkg/dependencies/cargo_deny.go`:**

- `RunCargoDenyList()` - Invokes `cargo deny list` for dependency enumeration
- `parseCargoDenyList()` - Parses table output format
- `parseLicenseExpression()` - Handles SPDX-like expressions (`MIT OR Apache-2.0`)
- `CargoDenyLabel` struct - Captures span information (file:line:col, message)
- `FormatMessage()` enhancement - Includes label context in formatted output

**Documentation added:**
- In-code comments explaining stderr behavior
- Notes about command argument ordering
- Cross-references between internal/assess and pkg/dependencies

---

## Migration

No breaking changes. Existing cargo-deny integrations will automatically benefit from:
- Richer error messages (no code changes required)
- Dependency listing via `--licenses` flag (opt-in)

---

## Acknowledgments

This release addresses issues discovered during [fulmen-toolbox](https://github.com/fulmenhq/fulmen-toolbox) testing with real Rust projects.

---

**Previous Releases**: See `docs/releases/` for older release notes.
