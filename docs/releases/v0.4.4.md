# Goneat v0.4.4 â€” Rust Dependency Analysis via cargo-deny

**Release Date**: 2026-01-09
**Status**: Stable

## TL;DR

- **Rust license checking**: `goneat dependencies --licenses` now works for Rust projects
- **cargo-deny integration**: License compliance and banned crate detection via cargo-deny
- **Cargo tool installer**: `kind: cargo` support in tools.yaml for installing Rust tools
- **Toolchain scopes**: Language-specific tool scopes (`go`, `rust`, `python`, `typescript`)
- **Smart guidance**: Helpful messages when cargo-deny is not installed
- **SSOT fix**: Provenance files now include trailing newlines (prevents format diffs in downstream repos)

## What Changed

### Rust Dependency Analysis

`goneat dependencies --licenses` now supports Rust projects via cargo-deny:

```bash
# Analyze Rust project licenses
cd my-rust-project
goneat dependencies --licenses

# JSON output for CI integration
goneat dependencies --licenses --format json
```

**Detection & Guidance**: When a Rust project is detected but cargo-deny is not available:

```
Rust project detected but cargo-deny not installed.

To set up Rust dependency checking:
  1. Install cargo-deny: cargo install cargo-deny
  2. Initialize config:  cargo deny init
  3. Learn more:         goneat docs show user-guide/rust/dependencies
```

### Severity Mapping

| Finding Type      | Severity | Example                              |
| ----------------- | -------- | ------------------------------------ |
| License violation | high     | Unlicensed crate, GPL in MIT project |
| Banned crate      | medium   | Duplicate versions, denied crate     |
| Informational     | low      | "license-not-encountered" warnings   |

### Cargo Tool Installer

New `kind: cargo` in tools.yaml schema enables installing Rust tools:

```yaml
tools:
  cargo-deny:
    name: cargo-deny
    description: License and dependency checking for Rust
    kind: cargo
    detect_command: cargo deny --version
    install_package: cargo-deny
    minimum_version: 0.14.0
```

Install via: `goneat doctor tools --scope rust --install --yes`

### Toolchain Scopes

Tools are now organized into language-specific scopes instead of mixing everything in `foundation`:

| Scope        | Purpose              | Key Tools                                                                                        |
| ------------ | -------------------- | ------------------------------------------------------------------------------------------------ |
| `foundation` | Language-agnostic    | ripgrep, jq, yq, yamlfmt, prettier, yamllint, shfmt, shellcheck, actionlint, checkmake, minisign |
| `go`         | Go development       | go, go-licenses, golangci-lint, goimports, gofmt, gosec, govulncheck                             |
| `rust`       | Rust Cargo plugins   | cargo-deny, cargo-audit                                                                          |
| `python`     | Python tools         | ruff (replaces black/flake8/isort)                                                               |
| `typescript` | TS/JS tools          | biome (replaces eslint/prettier for TS/JS/JSON)                                                  |
| `sbom`       | SBOM & vuln scanning | syft (SBOM generation), grype (vulnerability scanning)                                           |

**Usage examples:**

```bash
# Go project
goneat doctor tools --scope foundation,go --install --yes

# Rust project
goneat doctor tools --scope foundation,rust --install --yes

# Polyglot project (like goneat itself)
goneat doctor tools --scope foundation,go,rust,python,typescript --install --yes
```

**Why prettier stays in foundation**: It's our only Markdown formatter - every repo has README.md/docs. For TypeScript projects, biome handles TS/JS/JSON formatting (faster than prettier+eslint).

### Implementation Notes

Several cargo-deny integration quirks were discovered and documented:

1. **Argument order**: `--format json` must come BEFORE `check` subcommand
2. **STDERR output**: cargo-deny outputs JSON to stderr (intentional design)
3. **NDJSON format**: Output is newline-delimited JSON with nested `fields` object
4. **Informational codes**: "license-not-encountered" is informational, not a violation

See `pkg/dependencies/cargo_deny.go` for detailed comments.

### Bug Fixes

- **SSOT provenance trailing newline**: `goneat ssot sync` now writes provenance.json and metadata mirrors with trailing newlines, preventing format diffs when downstream repos run formatters after sync.

### Upstream Updates

- **Crucible v0.4.5**: Updated from v0.3.1 to v0.4.5
  - New agentic roles (prodmktg, uxdev)
  - Similarity library schemas and fixtures
  - Foundry signal resolution fixtures
  - Platform modules taxonomy v1.1.0

## Files Changed

### New Files

- `pkg/dependencies/cargo_deny.go` - Shared cargo-deny runner (~600 lines)

### Modified Files

- `pkg/dependencies/rust_analyzer.go` - Full implementation calling cargo-deny
- `cmd/dependencies.go` - Language-based analyzer selection
- `internal/doctor/tools.go` - Cargo installer support
- `schemas/tools/v1.1.0/tools-config.yaml` - Added `cargo` kind
- `internal/assets/embedded_schemas/schemas/tools/v1.1.0/tools-config.yaml` - Embedded schema sync
- `pkg/ssot/metadata.go` - Trailing newline fix for provenance files
- `config/tools/foundation-tools-defaults.yaml` - Reorganized into language-specific scopes
- `.goneat/tools.yaml` - Updated with all toolchain scopes for polyglot testing

## Upgrade Notes

### From v0.4.3

No breaking changes. New Rust functionality is additive.

**Rust projects**: To enable license checking:

1. Install cargo-deny: `cargo install cargo-deny`
2. Initialize config: `cargo deny init`
3. Run: `goneat dependencies --licenses`

**SSOT consumers**: After upgrading, run `goneat ssot sync` to regenerate provenance files with proper trailing newlines. This is a one-time fix.

## Documentation

- Rust feature brief: `.plans/active/v0.4.4/rust-dependencies-licenses-feature-brief.md`
- Toolchain scopes plan: `.plans/active/v0.4.4/toolchain-scopes-plan.md`
- cargo-deny integration: `pkg/dependencies/cargo_deny.go` (inline comments)

---

**Previous Releases**: See `docs/releases/` for older release notes.
