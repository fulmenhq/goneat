# Bug Report: Pre-Push Validation Bypass Issue

**Bug ID**: `v0.1.3-pre-push-validation-bug`
**Date Reported**: 2025-08-30
**Reporter**: Nova Prime
**Supervisor**: @3leapsdave
**Severity**: High
**Status**: ✅ **RESOLVED** - Fixed in v0.1.2

## Problem Summary

Pre-push validation is incorrectly passing despite lint issues that should cause failure when `--fail-on medium` is configured. This allows pushes with unresolved code quality issues, compromising the quality gate.

## Observed Behavior

- **Expected**: Push should fail when lint issues exceed medium severity threshold
- **Actual**: Push succeeds with 3 lint issues detected, health=85%
- **Hook Config**: `--fail-on medium` in `.goneat/hooks.yaml`
- **Issues Found**:
  - `tests/fixtures/go/lint/errcheck.go` (intentional test fixture)
  - `cmd/pretty.go` (actual code issue)

## Root Cause Analysis

### Current Hook Logic
```yaml
pre-push:
  - command: "assess"
    args: ["--check", "--fail-on", "medium"]
```

### Suspected Issues
1. **Severity Classification**: Lint issues may not be properly classified as "medium" severity
2. **Fail Logic**: The `--fail-on` flag may not be correctly implemented in the assess command
3. **Exit Code Handling**: Hook may not be respecting the exit code from goneat assess

## Reproduction Steps

1. Introduce lint issues in codebase
2. Run `git push origin main`
3. Observe: Push succeeds despite `--fail-on medium` configuration

## Impact Assessment

- **Quality Gates**: Bypassed, allowing substandard code to be pushed
- **CI/CD Reliability**: False positive validations undermine trust
- **Development Workflow**: Developers may not fix issues if validation doesn't enforce them

## Resolution

**✅ FIXED**: Pre-push validation now correctly enforces `--fail-on medium` from hooks.yaml manifest.

### Root Cause Identified
The `loadHookManifest()` function was not parsing the `args` array from the schema-driven hooks section to extract the `--fail-on` value.

### Solution Implemented
1. **Added `parseFailOnFromHooks()` function** to extract `--fail-on` value from hook command args
2. **Modified `loadHookManifest()`** to parse args and set `cfg.FailOn` accordingly
3. **Maintained backward compatibility** with fallback to defaults

### Code Changes
- **File**: `cmd/assess.go`
- **Functions**: `parseFailOnFromHooks()`, `loadHookManifest()`
- **Lines**: Added arg parsing logic for schema-driven hooks

### Validation
- ✅ Hook now fails on medium severity issues when `--fail-on medium` configured
- ✅ Hook passes when no issues exceed threshold
- ✅ Backward compatibility maintained
- ✅ No breaking changes to existing functionality

## Test Cases

### Positive Test (Should Pass)
- No lint issues → Push succeeds

### Negative Tests (Should Fail)
- Medium severity lint issues → Push fails
- High severity lint issues → Push fails

## Related Files

- `.goneat/hooks.yaml` - Hook configuration
- `internal/assess/runner.go` - Lint runner implementation
- `cmd/assess.go` - Assess command logic

## Mitigation

**Immediate**: Manual code review required for all pushes until fixed
**Short-term**: Consider removing `--fail-on` flag from pre-push until resolved

## Timeline

- **v0.1.3-alpha**: Investigation complete
- **v0.1.3-beta**: Fix implemented
- **v0.1.3-rc**: Validation complete
- **v0.1.3**: Release with fix

---

**Generated by**: Nova Prime ([Opencode](https://opencode.ai/)) under supervision of [@3leapsdave](https://github.com/3leapsdave)

**Co-Authored-By**: Nova Prime <noreply@3leaps.net>
**Authored-By**: Dave Thompson <dave.thompson@3leaps.net> [@3leapsdave](https://github.com/3leapsdave)