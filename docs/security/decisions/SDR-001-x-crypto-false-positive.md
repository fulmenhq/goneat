# SDR-001: GHSA-v778-237x-gjrc False Positive in x/crypto

**Date:** 2026-01-17
**Status:** Approved
**Author:** Claude Opus 4.5 (devlead)
**Reviewer:** @3leapsdave

## Context

During v0.5.1 security remediation, grype flagged GHSA-v778-237x-gjrc (CVE-2024-45337) as a critical vulnerability in `golang.org/x/crypto`. Investigation determined this is a false positive due to how grype interprets Go module version requirements.

## Finding

| Field | Value |
|-------|-------|
| ID | GHSA-v778-237x-gjrc / CVE-2024-45337 |
| Severity | Critical |
| Package | golang.org/x/crypto |
| Scanner | grype via syft SBOM |
| First Seen | 2026-01-17 |
| Fix Version | v0.31.0 |

**Grype report:**
```json
{
  "id": "GHSA-v778-237x-gjrc",
  "purls": ["pkg:golang/golang.org/x/crypto@v0.17.0"],
  "fix_versions": ["0.31.0"],
  "fix_state": "fixed"
}
```

## Analysis

### Root Cause

The SBOM generated by syft includes transitive dependency version requirements, not just resolved versions. `github.com/ProtonMail/go-crypto@v1.1.6` declares a minimum requirement of `golang.org/x/crypto@v0.17.0` in its `go.mod`.

However, Go's Minimal Version Selection (MVS) algorithm resolves the actual version used in the build to the highest compatible version across all requirements.

### Verification

**Declared requirement (from ProtonMail/go-crypto):**
```bash
$ go mod graph | grep "x/crypto@v0.17"
github.com/ProtonMail/go-crypto@v1.1.6 golang.org/x/crypto@v0.17.0
```

**Actual resolved version:**
```bash
$ go list -m golang.org/x/crypto
golang.org/x/crypto v0.42.0
```

**Version comparison:**
- Required minimum: v0.17.0
- Fix version: v0.31.0
- Actual resolved: v0.42.0 (patched)

### Vulnerability Details

CVE-2024-45337 is an authorization bypass in `ServerConfig.PublicKeyCallback` in the SSH package. Applications misusing this callback could allow attackers to authenticate with one key while security decisions are made based on a different key.

**Exploitability in goneat:** None. Goneat does not use x/crypto's SSH server functionality. The package is a transitive dependency used for cryptographic primitives only.

## Decision

**Classification:** False Positive

**Rationale:**
1. The actual resolved version (v0.42.0) is patched (fix was v0.31.0)
2. Go MVS guarantees the highest compatible version is used
3. The vulnerability is in SSH server code not used by goneat
4. Grype is incorrectly flagging the minimum version requirement, not the resolved version

**Options Considered:**

1. **Suppress in allowlist** - Add to `.goneat/dependencies.yaml` with documentation
   - Pros: Stops false positive from failing CI, documents decision
   - Cons: Requires maintenance if grype behavior changes

2. **Wait for grype fix** - Do nothing, accept CI noise
   - Pros: No config changes
   - Cons: Noisy reports, unclear to future maintainers

3. **Force x/crypto upgrade in ProtonMail/go-crypto** - Not possible
   - Pros: Would eliminate the finding
   - Cons: Upstream dependency, not our code

**Chosen:** Option 1 - Suppress with documentation. The false positive is well-understood and documented.

## Verification

```bash
# Confirm resolved version is patched
$ go list -m golang.org/x/crypto
golang.org/x/crypto v0.42.0

# Confirm v0.42.0 > v0.31.0 (fix version)
# v0.42.0 was released 2025-01-07, well after fix

# Confirm goneat doesn't use SSH server
$ grep -r "ssh.ServerConfig" --include="*.go" .
# No results
```

## Action Items

- [x] Document analysis in SDR
- [x] Add allowlist entry to `.goneat/dependencies.yaml`
- [ ] Monitor grype/syft for improved Go module handling
- [ ] Re-evaluate if ProtonMail/go-crypto updates its minimum requirement

## References

- [GHSA-v778-237x-gjrc](https://github.com/advisories/GHSA-v778-237x-gjrc)
- [CVE-2024-45337](https://nvd.nist.gov/vuln/detail/CVE-2024-45337)
- [Go Minimal Version Selection](https://go.dev/ref/mod#minimal-version-selection)
- [x/crypto v0.31.0 release](https://github.com/golang/crypto/releases/tag/v0.31.0)
