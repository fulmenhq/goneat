# phases.yaml - Repository Phases Configuration
# *(Generated by Arch Eagle: Schema for RELEASE/LIFECYCLE phases with metadata for 0.2.7 features like coverage keying)*
$schema: https://json-schema.org/draft/2020-12/schema
$id: https://schemas.goneat.io/repository/phases-v1.0.0.yaml
title: Repository Phases Configuration
description: Defines RELEASE_PHASE and LIFECYCLE_PHASE with rules/metadata (e.g., for coverage thresholds).
type: object
properties:
  release_phases: # RELEASE_PHASE: Preparation states (dev/rc/release/hotfix)
    type: object
    additionalProperties: false # Enforce exact enum keys
    patternProperties:
      ^(dev|rc|release|hotfix)$: # Enum: Exact phase keys
        type: object
        properties:
          allowed_suffixes: # Version suffixes per phase
            type: array
            items: {type: string, pattern: "^-?[a-z0-9.-]+$"}
            default: []
          min_coverage: # For 0.2.7 coverage keying (0-100%)
            type: number
            minimum: 0
            maximum: 100
            default: 80
          allow_dirty_git: # Allow uncommitted changes?
            type: boolean
            default: false
          required_docs: # Docs required for this phase
            type: array
            items: {type: string, enum: ["CHANGELOG.md", "RELEASE_NOTES.md", "docs/releases/"]}
            default: ["CHANGELOG.md"]
          error_level: # warn/error/skip for violations
            type: string
            enum: ["warn", "error", "skip"]
            default: "warn"
          coverage_exceptions: # Package globs to override min_coverage (e.g., {"node_modules/**": 0}); lang-agnostic for multi-lang support
            type: object
            additionalProperties: {type: number, minimum: 0, maximum: 100}
            default: {}
        required: ["allowed_suffixes"]
    required: ["release_phases"]
    default:
      dev: {allowed_suffixes: ["-dev", "-alpha"], min_coverage: 50, allow_dirty_git: true, coverage_exceptions: {"tests/**": 100}}
      rc: {allowed_suffixes: ["-rc.1", "-rc.2"], min_coverage: 75, allow_dirty_git: false, coverage_exceptions: {"node_modules/**": 0}}
      release: {allowed_suffixes: [], min_coverage: 90, allow_dirty_git: false, coverage_exceptions: {"docs/**": 100}}
      hotfix: {allowed_suffixes: ["-hotfix.1"], min_coverage: 80, allow_dirty_git: false}
  lifecycle_phases: # LIFECYCLE_PHASE: Maturity states (alpha/beta/ga/maintenance)
    type: object
    additionalProperties: false
    patternProperties:
      ^(alpha|beta|ga|maintenance)$: # Enum: Exact phase keys
        type: object
        properties:
          min_coverage: # Phase-keyed coverage threshold
            type: number
            minimum: 0
            maximum: 100
            default: 90
          support_duration: # ISO duration for maintenance (e.g., P1Y)
            type: string
            pattern: "^P[0-9]+Y$"
            default: "P1Y"
          required_features: # e.g., ["hooks", "schemas"] for this phase
            type: array
            items: {type: string}
            default: []
          error_level:
            type: string
            enum: ["warn", "error", "skip"]
            default: "warn"
          coverage_exceptions: # Package globs to override min_coverage (lang-agnostic for multi-lang)
            type: object
            additionalProperties: {type: number, minimum: 0, maximum: 100}
            default: {}
        required: ["min_coverage"]
    required: ["lifecycle_phases"]
    default:
      alpha: {min_coverage: 50, coverage_exceptions: {"prototypes/**": 0}}
      beta: {min_coverage: 75}
      ga: {min_coverage: 90}
      maintenance: {min_coverage: 80, support_duration: "P1Y"}
additionalProperties: false
