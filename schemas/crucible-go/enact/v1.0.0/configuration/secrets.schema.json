{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.fulmenhq.dev/enact/v1.0.0/configuration/secrets.schema.json",
  "title": "Enact Secrets Schema",
  "description": "Documents required secrets for a deployment. This schema defines WHAT credentials are needed, not the values themselves. Ship this with recipes to tell operators what they need to provide.",
  "$defs": {
    "secretGenerator": {
      "type": "string",
      "enum": [
        "manual",
        "random",
        "derived",
        "provider"
      ],
      "description": "How this secret value should be obtained"
    },
    "secretDefinition": {
      "type": "object",
      "description": "Definition of a single secret",
      "properties": {
        "description": {
          "type": "string",
          "description": "What this secret is for"
        },
        "required": {
          "type": "boolean",
          "default": true,
          "description": "Whether this secret must be provided"
        },
        "generator": {
          "$ref": "#/$defs/secretGenerator",
          "default": "manual",
          "description": "How to obtain the value"
        },
        "length": {
          "type": "integer",
          "minimum": 8,
          "description": "For random generator: character length"
        },
        "charset": {
          "type": "string",
          "enum": [
            "alphanumeric",
            "alphanumeric-special",
            "hex",
            "base64"
          ],
          "default": "alphanumeric",
          "description": "For random generator: allowed characters"
        },
        "derived_from": {
          "type": "string",
          "description": "For derived generator: source secret name"
        },
        "example": {
          "type": "string",
          "description": "Example value format (not a real value)"
        },
        "docs_url": {
          "type": "string",
          "format": "uri",
          "description": "URL to documentation on obtaining this secret"
        },
        "rotation_days": {
          "type": "integer",
          "minimum": 0,
          "description": "Recommended rotation period (0 = no rotation)"
        },
        "sensitive": {
          "type": "boolean",
          "default": true,
          "description": "Whether to mask in logs"
        },
        "category": {
          "type": "string",
          "enum": [
            "provider",
            "database",
            "application",
            "integration",
            "encryption"
          ],
          "description": "Secret category for organization"
        },
        "components": {
          "type": "array",
          "items": {
            "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug"
          },
          "description": "Components that use this secret"
        },
        "env_var": {
          "type": "string",
          "pattern": "^[A-Z][A-Z0-9_]*$",
          "description": "Environment variable name (if different from key)"
        }
      },
      "required": [
        "description"
      ],
      "additionalProperties": false
    }
  },
  "type": "object",
  "properties": {
    "schema_version": {
      "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/schemaVersion"
    },
    "metadata": {
      "type": "object",
      "properties": {
        "title": {
          "type": "string",
          "description": "Secrets manifest title"
        },
        "description": {
          "type": "string",
          "description": "Description of this secrets set"
        },
        "for_recipe": {
          "type": "string",
          "description": "Recipe name this secrets manifest is for"
        },
        "variant": {
          "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug",
          "description": "System variant this applies to"
        }
      },
      "additionalProperties": false
    },
    "encryption": {
      "type": "object",
      "description": "Encryption configuration for the secrets file",
      "properties": {
        "method": {
          "type": "string",
          "enum": [
            "gpg-symmetric",
            "gpg-asymmetric",
            "age",
            "sops"
          ],
          "default": "gpg-symmetric",
          "description": "Encryption method"
        },
        "tool": {
          "type": "string",
          "description": "Tool used for encryption/decryption",
          "default": "fulsecrets"
        },
        "recipients": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "For asymmetric: key IDs or fingerprints"
        }
      },
      "additionalProperties": false
    },
    "secrets": {
      "type": "object",
      "description": "Secret definitions keyed by environment variable name",
      "propertyNames": {
        "pattern": "^[A-Z][A-Z0-9_]*$"
      },
      "additionalProperties": {
        "$ref": "#/$defs/secretDefinition"
      }
    },
    "groups": {
      "type": "object",
      "description": "Logical groupings of secrets",
      "additionalProperties": {
        "type": "object",
        "properties": {
          "name": {
            "type": "string"
          },
          "description": {
            "type": "string"
          },
          "secrets": {
            "type": "array",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  },
  "required": [
    "schema_version",
    "secrets"
  ],
  "additionalProperties": false
}
