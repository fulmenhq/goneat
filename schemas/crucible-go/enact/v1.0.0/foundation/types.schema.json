{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json",
  "title": "Enact Foundation Types",
  "description": "Shared type definitions used across all Enact schemas. Import via $ref.",
  "$defs": {
    "schemaLayer": {
      "type": "string",
      "enum": [
        "foundation",
        "taxonomy",
        "configuration",
        "state",
        "execution"
      ],
      "description": "Schema layers in dependency/conceptual order. Foundation has no dependencies; each subsequent layer may reference prior layers.",
      "$comment": "Order: 0=foundation, 1=taxonomy, 2=configuration, 3=state, 4=execution"
    },
    "schemaLayerMeta": {
      "type": "object",
      "description": "Metadata about a schema layer",
      "properties": {
        "slug": {
          "$ref": "#/$defs/schemaLayer"
        },
        "order": {
          "type": "integer",
          "minimum": 0,
          "description": "Sort order (lower = earlier in dependency chain)"
        },
        "name": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "purpose": {
          "type": "string",
          "description": "One-line purpose statement"
        },
        "depends_on": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/schemaLayer"
          },
          "description": "Layers this layer may reference"
        }
      },
      "required": [
        "slug",
        "order",
        "name"
      ],
      "additionalProperties": false
    },
    "schemaLayers": {
      "type": "array",
      "description": "Canonical ordering of schema layers",
      "items": {
        "$ref": "#/$defs/schemaLayerMeta"
      },
      "default": [
        {
          "slug": "foundation",
          "order": 0,
          "name": "Foundation",
          "purpose": "Shared types and primitives",
          "description": "Reusable type definitions (slugs, timestamps, IDs) used across all schemas. The basement - no external dependencies.",
          "depends_on": []
        },
        {
          "slug": "taxonomy",
          "order": 1,
          "name": "Taxonomy",
          "purpose": "What vocabulary exists",
          "description": "Reference data defining valid values: components, phases, variants, providers. Changes infrequently. Split into schema (structure) and data (values).",
          "depends_on": [
            "foundation"
          ]
        },
        {
          "slug": "configuration",
          "order": 2,
          "name": "Configuration",
          "purpose": "What you want to build",
          "description": "Operator-provided specifications: recipes define desired deployments, secrets schemas document required credentials.",
          "depends_on": [
            "foundation",
            "taxonomy"
          ]
        },
        {
          "slug": "state",
          "order": 3,
          "name": "State",
          "purpose": "What actually exists",
          "description": "Actual deployed infrastructure and services. Inventory is source of truth for what's running. Updated by runner, used for diffs.",
          "depends_on": [
            "foundation",
            "taxonomy"
          ]
        },
        {
          "slug": "execution",
          "order": 4,
          "name": "Execution",
          "purpose": "What happened",
          "description": "Operational records: runlogs capture execution history, health reports capture check results, metrics define observability.",
          "depends_on": [
            "foundation",
            "taxonomy",
            "state"
          ]
        }
      ]
    },
    "taxonomyCategory": {
      "type": "string",
      "enum": [
        "system-components",
        "runbook-phases",
        "system-variants",
        "cloud-providers"
      ],
      "description": "Taxonomy categories in conceptual order",
      "$comment": "Order: components define what, phases define when, variants define scale, providers define where"
    },
    "schemaVersion": {
      "type": "string",
      "pattern": "^\\d+\\.\\d+\\.\\d+$",
      "description": "Semantic version of the schema this document conforms to",
      "examples": [
        "1.0.0",
        "2.1.0"
      ]
    },
    "slug": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
      "minLength": 2,
      "maxLength": 64,
      "description": "URL-safe lowercase identifier with hyphens",
      "examples": [
        "reverse-proxy",
        "digital-ocean",
        "tutor-nightly",
        "ha"
      ]
    },
    "slugRef": {
      "type": "string",
      "pattern": "^[a-z][a-z0-9]*(-[a-z0-9]+)*$",
      "description": "Reference to a slug defined in a taxonomy"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp with timezone (UTC preferred)",
      "examples": [
        "2024-12-16T14:30:00Z",
        "2024-12-16T09:30:00-05:00"
      ]
    },
    "providerId": {
      "type": "string",
      "pattern": "^[a-z]{2,12}:[a-z][a-z0-9-]*:[a-zA-Z0-9_-]+$",
      "description": "Namespaced provider resource identifier: provider:resource_type:id",
      "examples": [
        "do:droplet:12345678",
        "do:database:abcd1234",
        "do:space:my-bucket",
        "cf:zone:xyz789",
        "cf:dns:rec004",
        "hz:server:abc123"
      ]
    },
    "ipv4Address": {
      "type": "string",
      "format": "ipv4",
      "description": "IPv4 address",
      "examples": [
        "167.99.123.45",
        "10.132.0.2"
      ]
    },
    "ipv6Address": {
      "type": "string",
      "format": "ipv6",
      "description": "IPv6 address"
    },
    "hostname": {
      "type": "string",
      "format": "hostname",
      "description": "Valid DNS hostname",
      "examples": [
        "lms.example.com",
        "app-01.internal"
      ]
    },
    "domainName": {
      "type": "string",
      "pattern": "^([a-zA-Z0-9]([a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\\.)+[a-zA-Z]{2,}$",
      "description": "Fully qualified domain name",
      "examples": [
        "example.com",
        "lms.insight92.com"
      ]
    },
    "port": {
      "type": "integer",
      "minimum": 1,
      "maximum": 65535,
      "description": "TCP/UDP port number"
    },
    "url": {
      "type": "string",
      "format": "uri",
      "pattern": "^https?://",
      "description": "HTTP or HTTPS URL",
      "examples": [
        "https://lms.example.com",
        "http://localhost:8000"
      ]
    },
    "emailAddress": {
      "type": "string",
      "format": "email",
      "description": "Email address"
    },
    "sha256Hash": {
      "type": "string",
      "pattern": "^sha256:[a-f0-9]{64}$",
      "description": "SHA-256 hash with prefix",
      "examples": [
        "sha256:e3b0c44298fc1c149afbf4c8996fb92427ae41e4649b934ca495991b7852b855"
      ]
    },
    "filePath": {
      "type": "string",
      "pattern": "^/[^\\0]*$",
      "description": "Absolute POSIX file path",
      "examples": [
        "/opt/Enact/config.yaml",
        "/var/lib/tutor/data"
      ]
    },
    "cidrBlock": {
      "type": "string",
      "pattern": "^([0-9]{1,3}\\.){3}[0-9]{1,3}/[0-9]{1,2}$",
      "description": "IPv4 CIDR notation",
      "examples": [
        "10.0.0.0/8",
        "192.168.1.0/24",
        "0.0.0.0/0"
      ]
    },
    "statusEnum": {
      "type": "string",
      "enum": [
        "pending",
        "running",
        "completed",
        "failed",
        "skipped",
        "unknown"
      ],
      "description": "Execution or operational status"
    },
    "healthStatus": {
      "type": "string",
      "enum": [
        "pass",
        "fail",
        "warn",
        "skip",
        "unknown"
      ],
      "description": "Health check result status"
    },
    "changeAction": {
      "type": "string",
      "enum": [
        "create",
        "update",
        "delete",
        "unchanged",
        "recreate"
      ],
      "description": "Type of change action in a plan or log"
    },
    "serviceStatus": {
      "type": "string",
      "enum": [
        "running",
        "stopped",
        "starting",
        "stopping",
        "restarting",
        "failed",
        "unknown"
      ],
      "description": "Container or service runtime status"
    },
    "keyValuePair": {
      "type": "object",
      "properties": {
        "key": {
          "type": "string"
        },
        "value": {
          "type": "string"
        }
      },
      "required": [
        "key",
        "value"
      ],
      "additionalProperties": false
    },
    "labelSet": {
      "type": "object",
      "additionalProperties": {
        "type": "string"
      },
      "propertyNames": {
        "pattern": "^[a-z][a-z0-9_]*$"
      },
      "description": "Key-value labels for metadata and filtering"
    },
    "tagList": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/slug"
      },
      "uniqueItems": true,
      "description": "List of unique tag slugs"
    },
    "markdown": {
      "type": "string",
      "description": "Markdown-formatted text content"
    },
    "nonEmptyString": {
      "type": "string",
      "minLength": 1,
      "description": "String that cannot be empty"
    },
    "positiveInteger": {
      "type": "integer",
      "minimum": 1,
      "description": "Integer greater than zero"
    },
    "nonNegativeInteger": {
      "type": "integer",
      "minimum": 0,
      "description": "Integer zero or greater"
    },
    "percentage": {
      "type": "number",
      "minimum": 0,
      "maximum": 100,
      "description": "Percentage value 0-100"
    },
    "durationSeconds": {
      "type": "integer",
      "minimum": 0,
      "description": "Duration in seconds"
    },
    "durationMilliseconds": {
      "type": "integer",
      "minimum": 0,
      "description": "Duration in milliseconds"
    },
    "byteSize": {
      "type": "integer",
      "minimum": 0,
      "description": "Size in bytes"
    },
    "sshPublicKeyFingerprint": {
      "type": "string",
      "pattern": "^SHA256:[A-Za-z0-9+/=]{43}$",
      "description": "SSH public key fingerprint (SHA256 format)",
      "examples": [
        "SHA256:abc123DEF456ghi789JKL012mno345PQR678stu901V"
      ]
    },
    "dockerImage": {
      "type": "string",
      "pattern": "^[a-z0-9][a-z0-9._/-]*:[a-zA-Z0-9][a-zA-Z0-9._-]*$",
      "description": "Docker image reference with tag",
      "examples": [
        "caddy:2.8.4-alpine",
        "ghcr.io/goauthentik/server:2024.10.2"
      ]
    },
    "containerId": {
      "type": "string",
      "pattern": "^[a-f0-9]{12,64}$",
      "description": "Docker container ID (short or full)",
      "examples": [
        "abc123def456",
        "abc123def456789012345678901234567890123456789012345678901234"
      ]
    },
    "semver": {
      "type": "string",
      "pattern": "^(0|[1-9]\\d*)\\.(0|[1-9]\\d*)\\.(0|[1-9]\\d*)(?:-((?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*)(?:\\.(?:0|[1-9]\\d*|\\d*[a-zA-Z-][0-9a-zA-Z-]*))*))?(?:\\+([0-9a-zA-Z-]+(?:\\.[0-9a-zA-Z-]+)*))?$",
      "description": "Semantic version string",
      "examples": [
        "1.0.0",
        "2.1.0-beta.1",
        "18.1.3+build.456"
      ]
    },
    "versionConstraint": {
      "type": "string",
      "pattern": "^(>=?|<=?|=|~|\\^)?\\d+(\\.\\d+)?(\\.\\d+)?$",
      "description": "Version constraint for dependency resolution",
      "examples": [
        ">=1.0.0",
        "^2.0.0",
        "~18.1.0",
        "=3.0.0"
      ]
    }
  }
}
