{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://schemas.fulmenhq.dev/enact/v1.0.0/taxonomy/runbook-phases/runbook-phases.schema.json",
  "title": "Runbook Phases Taxonomy",
  "description": "Defines the structure for runbook execution phases. Phases represent ordered steps in deployment with dependencies.",
  "$defs": {
    "phaseAction": {
      "type": "object",
      "description": "A specific action within a phase",
      "properties": {
        "slug": {
          "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug"
        },
        "name": {
          "type": "string",
          "description": "Human-readable action name"
        },
        "description": {
          "type": "string",
          "description": "What this action does"
        },
        "idempotent": {
          "type": "boolean",
          "default": true,
          "description": "Whether this action is safe to run multiple times"
        },
        "reversible": {
          "type": "boolean",
          "default": false,
          "description": "Whether this action can be undone"
        },
        "estimated_duration_seconds": {
          "type": "integer",
          "minimum": 0,
          "description": "Typical execution time"
        }
      },
      "required": [
        "slug",
        "name"
      ],
      "additionalProperties": false
    },
    "phase": {
      "type": "object",
      "description": "A runbook execution phase",
      "properties": {
        "slug": {
          "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug"
        },
        "order": {
          "type": "integer",
          "minimum": 0,
          "description": "Execution order (lower runs first)"
        },
        "name": {
          "type": "string",
          "description": "Human-readable phase name"
        },
        "description": {
          "type": "string",
          "description": "What this phase accomplishes"
        },
        "category": {
          "type": "string",
          "enum": [
            "prerequisites",
            "infrastructure",
            "platform",
            "application",
            "verification",
            "maintenance"
          ],
          "description": "Phase category for grouping"
        },
        "depends_on": {
          "type": "array",
          "items": {
            "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug"
          },
          "description": "Phase slugs that must complete before this phase"
        },
        "components": {
          "type": "array",
          "items": {
            "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/slug"
          },
          "description": "Component slugs this phase operates on"
        },
        "actions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/phaseAction"
          },
          "description": "Actions performed in this phase"
        },
        "skip_conditions": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "Conditions under which this phase is skipped",
          "examples": [
            [
              "variant:minimal",
              "component:monitoring:disabled"
            ]
          ]
        },
        "required_tools": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "CLI tools required for this phase",
          "examples": [
            [
              "doctl",
              "ssh",
              "docker"
            ]
          ]
        },
        "estimated_duration_seconds": {
          "type": "integer",
          "minimum": 0,
          "description": "Typical phase duration in seconds"
        },
        "human_intervention": {
          "type": "boolean",
          "default": false,
          "description": "Whether this phase may require human input"
        }
      },
      "required": [
        "slug",
        "order",
        "name",
        "category"
      ],
      "additionalProperties": false
    }
  },
  "type": "object",
  "properties": {
    "schema_version": {
      "$ref": "https://schemas.fulmenhq.dev/enact/v1.0.0/foundation/types.schema.json#/$defs/schemaVersion"
    },
    "taxonomy": {
      "const": "runbook-phases",
      "description": "Taxonomy identifier"
    },
    "title": {
      "type": "string"
    },
    "description": {
      "type": "string"
    },
    "phases": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/phase"
      },
      "description": "List of execution phases in order"
    }
  },
  "required": [
    "schema_version",
    "taxonomy",
    "phases"
  ],
  "additionalProperties": false
}
