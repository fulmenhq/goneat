$schema: https://json-schema.org/draft/2020-12/schema
type: object
description: "Configuration for goneat doctor tools command - defines scopes and tool definitions"
properties:
  scopes:
    type: object
    description: "Tool scopes that group related tools together"
    patternProperties:
      "^[a-z][a-z0-9-]*$":
        type: object
        description: "A tool scope definition"
        properties:
          description:
            type: string
            description: "Human-readable description of what this scope covers"
            minLength: 1
            maxLength: 200
          tools:
            type: array
            description: "List of tool names that belong to this scope"
            items:
              type: string
              pattern: "^[a-z][a-z0-9-]*$"
              description: "Tool name (must match a key in the tools section)"
            minItems: 1
            uniqueItems: true
          replace:
            type: boolean
            description: "When true, replace built-in scope definition instead of extending"
        required: ["description", "tools"]
        additionalProperties: false
    minProperties: 1
    additionalProperties: false
  tools:
    type: object
    description: "Tool definitions with detection and installation methods"
    patternProperties:
      "^[a-z][a-z0-9-]*$":
        $ref: "#/$defs/tool"
    minProperties: 1
    additionalProperties: false
$defs:
  tool:
    type: object
    description: "Definition of a single tool with platform-specific installation methods"
    properties:
      name:
        type: string
        description: "Canonical name of the tool (should match the key)"
        pattern: "^[a-z][a-z0-9-]*$"
        minLength: 1
        maxLength: 50
      description:
        type: string
        description: "Human-readable description of the tool's purpose"
        minLength: 1
        maxLength: 200
      kind:
        type: string
        description: "Type of tool installation method"
        enum: ["go", "bundled-go", "system", "node", "python"]
      detect_command:
        type: string
        description: "Command to detect if tool is installed (e.g., 'rg --version')"
        minLength: 1
        maxLength: 100
      install_package:
        type: string
        description: "Go package path for 'go' kind tools (e.g., 'github.com/securego/gosec/v2/cmd/gosec@latest')"
        pattern: "^[a-zA-Z0-9._/-]+@[a-zA-Z0-9._/-]+$"
        minLength: 1
        maxLength: 200
      version_args:
        type: array
        description: "Arguments to get version information"
        items:
          type: string
          minLength: 1
          maxLength: 50
        maxItems: 10
      check_args:
        type: array
        description: "Arguments to check if tool works (usually help/usage)"
        items:
          type: string
          minLength: 1
          maxLength: 50
        maxItems: 10
      platforms:
        type: array
        description: "Supported platforms for system tools"
        items:
          type: string
          enum: ["darwin", "linux", "windows", "*"]
        minItems: 1
        uniqueItems: true
      install_commands:
        type: object
        description: "Installation commands keyed by platform or installer keyword (e.g., darwin, linux, mise, scoop)"
        propertyNames:
          pattern: "^[a-z][a-z0-9_-]*$"
        additionalProperties:
          type: string
          minLength: 1
          maxLength: 2000
        minProperties: 1
      version_scheme:
        type: string
        description: "Version comparison scheme (semver-full, semver-compact, calver, lexical)"
        enum: ["semver", "semver-full", "semver-compact", "calver", "lexical"]
      minimum_version:
        type: string
        description: "Minimum supported version that must be present"
        minLength: 1
        maxLength: 50
      recommended_version:
        type: string
        description: "Recommended version to target during upgrades"
        minLength: 1
        maxLength: 50
      disallowed_versions:
        type: array
        description: "Explicit versions that should never be used"
        items:
          type: string
          minLength: 1
          maxLength: 50
        uniqueItems: true
        maxItems: 20
      installer_priority:
        type: object
        description: "Preferred installer order per platform (keywords drawn from curated list: mise, brew, scoop, winget, pacman, apt-get, dnf, yum, go-install, manual)"
        propertyNames:
          pattern: "^(all|darwin|linux|windows)$"
        additionalProperties:
          type: array
          items:
            type: string
            pattern: "^[a-z][a-z0-9_-]*$"
          minItems: 1
          maxItems: 10
      artifacts:
        type: object
        description: "Trusted artifact manifest for supply-chain integrity (download URLs with SHA256 verification)"
        properties:
          default_version:
            type: string
            description: "Default version to install when user doesn't specify --version"
            pattern: "^[0-9]+\\.[0-9]+\\.[0-9]+$"
            minLength: 5
            maxLength: 20
          versions:
            type: object
            description: "Map of version numbers to platform-specific artifacts"
            patternProperties:
              "^[0-9]+\\.[0-9]+\\.[0-9]+$":
                $ref: "#/$defs/versionArtifacts"
            minProperties: 1
        required: ["default_version", "versions"]
        additionalProperties: false
    required: ["name", "description", "kind", "detect_command"]
    additionalProperties: false
  versionArtifacts:
    type: object
    description: "Platform-specific artifacts for a single version"
    properties:
      darwin_amd64:
        $ref: "#/$defs/artifact"
      darwin_arm64:
        $ref: "#/$defs/artifact"
      linux_amd64:
        $ref: "#/$defs/artifact"
      linux_arm64:
        $ref: "#/$defs/artifact"
      windows_amd64:
        $ref: "#/$defs/artifact"
    minProperties: 1
    additionalProperties: false
  artifact:
    type: object
    description: "Single artifact with URL and integrity hash"
    properties:
      url:
        type: string
        description: "Download URL for the artifact"
        pattern: "^https://"
        minLength: 10
        maxLength: 500
      sha256:
        type: string
        description: "SHA256 checksum for integrity verification"
        pattern: "^[a-f0-9]{64}$"
      extract_path:
        type: string
        description: "Optional path within archive to extract (default: tool name)"
        minLength: 1
        maxLength: 200
    required: ["url", "sha256"]
    additionalProperties: false
# Validation rules
required: ["scopes", "tools"]
additionalProperties: false
