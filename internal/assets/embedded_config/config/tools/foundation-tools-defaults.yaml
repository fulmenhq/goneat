version: v1.0.0

# Foundation Tools Defaults
# These tools can be seeded into .goneat/tools.yaml via `goneat doctor tools init`
# Organized by category with package manager preferences per platform
#
# Package Manager Strategy (v0.3.10+):
# - brew: Primary for system binaries on darwin/linux (user-mode install supported)
# - scoop/winget: Primary for Windows
# - go-install: Primary for Go tools (no package manager needed)
# - bun/npm: For Node.js packages only
# - uv/pip: For Python packages only
#
# Note: mise was removed - it's a version manager, not a general package manager

foundation_tools:
  # System CLI tools - use brew (supports user-mode install)
  - name: ripgrep
    description: "Fast text search - used by goneat for license auditing"
    kind: "system"
    detect_command: "rg --version"
    platforms: ["darwin", "linux", "windows"]
    package_managers:
      darwin: ["brew"]
      linux: ["brew"]
      windows: ["scoop", "winget"]
    auto_install_safe: true

  - name: jq
    description: "JSON processor - used in CI/CD scripts"
    kind: "system"
    detect_command: "jq --version"
    platforms: ["darwin", "linux", "windows"]
    package_managers:
      darwin: ["brew"]
      linux: ["brew"]
      windows: ["scoop", "winget"]
    auto_install_safe: true

  - name: yq
    description: "YAML processor"
    kind: "system"
    detect_command: "yq --version"
    platforms: ["darwin", "linux", "windows"]
    package_managers:
      darwin: ["brew"]
      linux: ["brew"]
      windows: ["scoop", "winget"]
    auto_install_safe: true

  - name: go
    description: "Go toolchain - required for Go projects"
    kind: "system"
    detect_command: "go version"
    platforms: ["darwin", "linux", "windows"]
    package_managers:
      darwin: ["brew"]
      linux: ["brew"]
      windows: ["scoop", "winget"]
    auto_install_safe: true
    required_for_languages: ["go"]
    version_scheme: "semver"
    minimum_version: "1.21.0"
    recommended_version: "1.22.0"

  # Go-installable tools - use go-install (native, no package manager needed)
  - name: go-licenses
    description: "License compliance for Go dependencies"
    kind: "go"
    detect_command: "go-licenses -h"
    install_package: "github.com/google/go-licenses@latest"
    version_args: []
    check_args: ["-h"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true
    required_for_languages: ["go"]

  - name: golangci-lint
    description: "Fast linters runner for Go"
    kind: "go"
    detect_command: "golangci-lint --version"
    install_package: "github.com/golangci/golangci-lint/cmd/golangci-lint@latest"
    version_args: ["--version"]
    check_args: ["--help"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true
    required_for_languages: ["go"]
    version_scheme: "semver"
    minimum_version: "1.54.0"
    recommended_version: "2.4.0"

  - name: yamlfmt
    description: "YAML formatter and linter"
    kind: "go"
    detect_command: "yamlfmt --version"
    install_package: "github.com/google/yamlfmt/cmd/yamlfmt@latest"
    version_args: ["--version"]
    check_args: ["--help"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true

# Security tools (Go-based, use go-install)
security_tools:
  - name: gosec
    description: "Go security checker"
    kind: "go"
    detect_command: "gosec -version"
    install_package: "github.com/securego/gosec/v2/cmd/gosec@latest"
    version_args: ["-version"]
    check_args: ["-h"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true
    required_for_languages: ["go"]

  - name: govulncheck
    description: "Go vulnerability checker"
    kind: "go"
    detect_command: "govulncheck -version"
    install_package: "golang.org/x/vuln/cmd/govulncheck@latest"
    version_args: ["-version"]
    check_args: ["-h"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true
    required_for_languages: ["go"]

  - name: gitleaks
    description: "Git secrets scanner"
    kind: "go"
    detect_command: "gitleaks version"
    install_package: "github.com/zricethezav/gitleaks/v8@latest"
    version_args: ["version"]
    check_args: ["help"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true

# Format tools (Go-based, use go-install)
format_tools:
  - name: goimports
    description: "Go import formatter"
    kind: "go"
    detect_command: "goimports -h"
    install_package: "golang.org/x/tools/cmd/goimports@latest"
    version_args: []
    check_args: ["-h"]
    package_managers:
      all: ["go-install"]
    auto_install_safe: true
    required_for_languages: ["go"]

  - name: gofmt
    description: "Go formatter (bundled with Go toolchain)"
    kind: "bundled-go"
    detect_command: "gofmt -h"
    version_args: []
    check_args: ["-h"]
    package_managers:
      all: ["builtin"]
    auto_install_safe: true
    required_for_languages: ["go"]

# Python tools (use uv/pip)
python_tools:
  - name: ruff
    description: "Fast Python linter and formatter"
    kind: "python"
    detect_command: "ruff --version"
    package_managers:
      all: ["uv", "pip"]
    auto_install_safe: true
    required_for_languages: ["python"]

  - name: black
    description: "Python code formatter"
    kind: "python"
    detect_command: "black --version"
    package_managers:
      all: ["uv", "pip"]
    auto_install_safe: true
    required_for_languages: ["python"]

# TypeScript/Node tools
typescript_tools:
  - name: prettier
    description: "Opinionated code formatter"
    kind: "node"
    detect_command: "prettier --version"
    package_managers:
      # brew can install prettier - use it to avoid needing bun for foundation scope
      darwin: ["brew"]
      linux: ["brew"]
      windows: ["scoop", "npm"]
    auto_install_safe: true
    # Note: prettier is also in foundation scope for YAML/markdown formatting

  - name: eslint
    description: "JavaScript/TypeScript linter"
    kind: "node"
    detect_command: "eslint --version"
    package_managers:
      # eslint is TypeScript-specific, use bun/npm (only installed for TS repos)
      all: ["bun", "npm"]
    auto_install_safe: true
    required_for_languages: ["typescript"]

# Scopes define which tools to include for each scope
scopes:
  bootstrap:
    description: "Minimal package managers for CI/CD bootstrap"
    # No tools yet - package managers install via auto-install logic
    # Tools will be installed in subsequent steps

  foundation:
    description: "Core foundation tools required for goneat and basic AI agent operation"
    tools:
      - ripgrep
      - jq
      - yq
      - go  # Only if Go repo detected
      - go-licenses  # Only if Go repo detected
      - golangci-lint  # Only if Go repo detected
      - yamlfmt
      - prettier  # Used by goneat format for markdown, JSON, YAML

  security:
    description: "Security scanning tools"
    tools:
      - gosec
      - govulncheck
      - gitleaks

  format:
    description: "Code formatting tools"
    tools:
      - goimports
      - gofmt

  all:
    description: "All tools from all scopes"
    tools:
      - ripgrep
      - jq
      - yq
      - go
      - go-licenses
      - golangci-lint
      - yamlfmt
      - prettier
      - gosec
      - govulncheck
      - gitleaks
      - goimports
      - gofmt
