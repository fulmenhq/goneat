# Goneat v0.3.12 Release Notes

**Release Date**: 2025-12-04
**Type**: Bugfix Release
**Priority**: High (fixes critical CI/DX workflow issue)

## Overview

v0.3.12 is a focused bugfix release addressing a critical yamlfmt compatibility issue in `goneat doctor tools init`. This bug caused fresh repository clones to fail formatting checks, undermining goneat's core value proposition of streamlining developer experience.

## Critical Fix: yamlfmt Compatibility

### The Problem

When developers ran `goneat doctor tools init` to bootstrap their `.goneat/tools.yaml` configuration, the generated file used 4-space indentation (YAML default) instead of 2-space indentation required by the repository's `.yamlfmt` configuration.

**Symptom**:

```bash
$ goneat doctor tools init
✨ Successfully created .goneat/tools.yaml

$ make fmt
yamlfmt dry run failed: exit status 1
Output: .goneat/tools.yaml: yaml: line 15: did not find expected key
```

**Impact**:

- Fresh clones failed CI after running `doctor tools init`
- Developers had to manually reformat generated configuration files
- Bootstrap workflows (`init` → `format` → `check`) consistently broke
- Contradicted "single source of truth" promise for tools.yaml
- Created friction in the exact workflow goneat was designed to smooth

### Root Cause Analysis

**Technical Details**:

```go
// Before (v0.3.11 and earlier)
data, err := yaml.Marshal(config)  // Uses 4-space indent by default
```

The `yaml.Marshal` function from `gopkg.in/yaml.v3` defaults to 4-space indentation, which is valid YAML but incompatible with yamlfmt's configuration requiring 2-space indentation.

**Why This Wasn't Caught**:

1. No test validated formatting compatibility of generated files
2. Manual testing likely involved post-generation formatting
3. CI didn't test fresh initialization workflows
4. Existing repositories had manually formatted configurations

### The Solution

**Code Changes**:

```go
// After (v0.3.12)
encoder := yaml.NewEncoder(file)
encoder.SetIndent(2)  // Match .yamlfmt configuration
if err := encoder.Encode(config); err != nil {
    return fmt.Errorf("failed to encode config: %w", err)
}
```

**Additional Improvements**:

- Remove extra blank line between header comments and YAML content
- Properly handle `file.Close()` errors (named return value pattern)
- Add regression test to verify yamlfmt compatibility

### Verification

**Manual Testing**:

```bash
# Generate new config
goneat doctor tools init --force

# Verify yamlfmt compatibility
yamlfmt -dry .goneat/tools.yaml
# Output: "No files will be changed" ✅
```

**Automated Testing**:

```bash
# New regression test
go test ./cmd -run TestDoctorToolsInitGeneratesYamlfmtCompatibleFile -v
# PASS ✅
```

## Files Modified

| File                            | Change Type | Description                               |
| ------------------------------- | ----------- | ----------------------------------------- |
| `cmd/doctor_tools_init.go`      | Fix         | Replace yaml.Marshal with yaml.NewEncoder |
| `cmd/doctor_tools_init_test.go` | Test        | Add yamlfmt compatibility regression test |
| `CHANGELOG.md`                  | Docs        | Document v0.3.12 bugfix                   |
| `RELEASE_NOTES.md`              | Docs        | Release notes for v0.3.12                 |
| `docs/releases/v0.3.12.md`      | Docs        | Detailed release documentation            |
| `VERSION`                       | Version     | Bump to v0.3.12                           |

## Upgrade Path

### For Repository Maintainers

If you're maintaining repositories that use goneat (e.g., forge-workhorse-groningen):

1. **Update bootstrap script** (`scripts/install-goneat.sh`):

   ```bash
   GONEAT_VERSION="v0.3.12"
   ```

2. **Update SHA256 checksums** (from GitHub release page):

   ```bash
   # darwin-amd64
   EXPECTED_SHA="<checksum>"
   # darwin-arm64
   EXPECTED_SHA="<checksum>"
   # linux-amd64
   EXPECTED_SHA="<checksum>"
   # linux-arm64
   EXPECTED_SHA="<checksum>"
   # windows-amd64
   EXPECTED_SHA="<checksum>"
   ```

3. **Optionally regenerate tools.yaml**:
   ```bash
   # This will now generate a properly formatted file
   goneat doctor tools init --force
   ```

### For Individual Developers

```bash
# Update local goneat installation
brew upgrade goneat  # if installed via Homebrew

# Or download latest release
curl -L https://github.com/fulmenhq/goneat/releases/download/v0.3.12/goneat_v0.3.12_<platform>.tar.gz | tar xz
```

## Testing Performed

### Regression Test Coverage

**New Test**: `TestDoctorToolsInitGeneratesYamlfmtCompatibleFile`

- Generates `.goneat/tools.yaml` via `doctor tools init`
- Verifies file uses 2-space indentation
- Ensures no tabs are used for indentation
- Validates file can be parsed and re-encoded consistently

**Existing Tests**: All pass ✅

```bash
go test ./cmd -run TestDoctorToolsInit -v
# 4 tests PASS
```

### Manual Verification

**Test Environment**: forge-workhorse-groningen repository

```bash
# Clean state
rm -rf .goneat/tools.yaml

# Install v0.3.12
./scripts/install-goneat.sh

# Generate config
goneat doctor tools init --force

# Verify formatting
yamlfmt -dry .goneat/tools.yaml
# Output: "No files will be changed" ✅

# Run full format workflow
make fmt
git diff --exit-code
# Exit code: 0 (no changes) ✅
```

## Known Issues

None. This is a focused bugfix release with no known regressions.

## Migration Notes

### Breaking Changes

**None**. This release is fully backwards compatible.

### Deprecations

**None**.

### Behavioral Changes

**Generated File Format**: `.goneat/tools.yaml` files generated by `doctor tools init` now use 2-space indentation instead of 4-space. This only affects newly generated files; existing configurations are unaffected.

## Performance Impact

**None**. The YAML encoding change has negligible performance impact.

## Security Considerations

**None**. This release does not introduce or fix any security issues.

## Contributors

- **Forge Neat** ([@forge-neat](https://github.com/forge-neat)) - Primary developer
- **@3leapsdave** - Supervision and release coordination

## Related Issues

- Bug Report: `../forge-workhorse-groningen/.plans/memos/goneat/tools-yaml-formatting-bug.md`
- Fix Commit: `a0ce6fe` - fix(doctor): ensure tools init generates yamlfmt-compatible YAML

## Links

- **Release**: https://github.com/fulmenhq/goneat/releases/tag/v0.3.12
- **Changelog**: [CHANGELOG.md](../../CHANGELOG.md)
- **Previous Release**: [v0.3.11](v0.3.11.md)

---

**Released**: 2025-12-04
**Status**: Stable
